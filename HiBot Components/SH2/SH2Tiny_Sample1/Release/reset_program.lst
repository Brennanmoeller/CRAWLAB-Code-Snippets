   1              	# 1 "../src/reset_program.asm"
   1              	/***********************************************************************/
   0              	
   0              	
   0              	
   2              	/*  													               */
   3              	/*      PROJECT NAME :  SH2Tiny_Sample1EclipseV3                       */
   4              	/*      FILE         :  reset_program.asm                              */
   5              	/*      DESCRIPTION  :  Reset Program                                  */
   6              	/*      CPU SERIES   :  SH2                                            */
   7              	/*      CPU TYPE     :  SH7047                                         */
   8              	/*  													               */
   9              	/*      This file is generated by KPIT Eclipse.                        */
  10              	/*  													               */
  11              	/***********************************************************************/                          
  12              	
  13              	
  14              		! Start.asm
  15              	
  16              		.list
  17              		.section .text
  18              		.global _PowerON_Reset  ! global Start routine 
  19              	
  20              	#ifdef CPPAPP	
  21              	___dso_handle:
  22              		.global ___dso_handle
  23              	#endif	
  24              	
  25              	#if INIT_SECTIONS
  26              		.extern _HardwareSetup ! external Sub-routine to initialise Hardware
  27              		.extern _data
  28              		.extern _mdata
  29              		.extern _ebss
  30              		.extern _bss
  31              	#endif	
  32              		.extern _edata
  33              		.extern _main 
  34              		.extern _stack
  35              		.extern _vects
  36              	#if GDB_SIMULATOR_DEBUG
  37              		.extern _exit
  38              	#endif
  39              	
  40              	_PowerON_Reset:
  41              		! initialise the SP for non-vectored code
  42 0000 DF15     		mov.l	stack,r15
  43              		
  44              	#if INIT_SECTIONS
  45              	
  46              	! Call HardwareSetup
  47 0002 D10F     		mov.l	HardwareSetup,r1
  48 0004 410B     		jsr     @r1
  49 0006 0009     		nop
  50              		
  51              	!load data section from ROM to RAM  
  52              	
  53              	! initialise sections
  54 0008 D110     		mov.l	edata,r1		! edata in r1
  55 000a D20F     		mov.l	mdata,r2		! mdata in r2
  56 000c D00D     		mov.l	data,r0		        ! data in r0
  57 000e 3100     		cmp/eq  r0,r1
  58 0010 8907     		bt	start_1
  59 0012 0009     		nop
  60              	start_l:
  61 0014 6320     		mov.b   @r2,r3  !get from src
  62 0016 2030     		mov.b   r3,@r0  !place in dest
  63 0018 7201     		add   	#1,r2    !inc src
  64 001a 7001     		add   	#1,r0    !inc dest
  65 001c 3100     		cmp/eq  r0,r1   !dest == edata?
  66 001e 8BF9     		bf	start_l
  67 0020 0009     		nop
  68              	start_1:
  69              	
  70              		! zero out bss
  71 0022 D10C     		mov.l	ebss,r1
  72 0024 D00A     		mov.l	bss,r0
  73 0026 3100     		cmp/eq	r0,r1         
  74 0028 8905     		bt	start_3
  75 002a 3228     		sub	r2,r2
  76              	start_2:
  77 002c 2020     		mov.b	r2,@r0
  78 002e 7001     		add	#1,r0
  79 0030 3100     		cmp/eq	r0,r1
  80 0032 8BFB     		bf     	start_2
  81 0034 0009     		nop
  82              	start_3:
  83              	
  84              	#endif 
  85              	
  86              	#ifdef CPPAPP	
  87              		!Initialize global constructor	
  88              		mov.l	_InitCtors,r1
  89              		jsr     @r1
  90              		nop
  91              	#endif
  92              	#if !defined (__SH2A_NOFPU__)
  93              	#if defined (__SH2A__) || defined (__SH2E__) || defined (__SH3E__) || defined(__SH4_SINGLE__) ||def
  94              		mov.l set_fpscr_k, r1
  95              		jsr @r1
  96              		mov #0,r4
  97              		lds r3,fpscr
  98              	#endif // defined (__SH2A__) || defined (__SH2E__) || defined (__SH3E__) || defined(__SH4_SINGLE__)
  99              	#endif // !defined (__SH2A_NOFPU__)
 100              	
 101 0036 D109     		mov.l	main,r1
 102 0038 410B     		jsr     @r1
 103 003a 0009     		nop
 104              		
 105              		! call to exit
 106              	#if GDB_SIMULATOR_DEBUG
 107              		mov.l	_exit_k,r1
 108              		jsr	@r1
 109              		nop
 110              	#endif
 111              	#if INIT_SECTIONS
 112              	exit:
 113 003c AFFE     		bra 	exit
 114 003e 0009     		nop
 115              	#endif
 116              	
 117              		.align 2
 118              	#if !defined (__SH2A_NOFPU__)
 119              	#if defined (__SH2A__) || defined (__SH2E__) || defined (__SH3E__) || defined(__SH4_SINGLE__) ||def
 120              	set_fpscr_k:
 121              			.long	___set_fpscr
 122              	#endif // defined (__SH2A__) || defined (__SH2E__) || defined (__SH3E__) || defined(__SH4_SINGLE__)
 123              	#endif // !defined (__SH2A_NOFPU__)
 124              	
 125              	
 126              		.ALIGN 4
 127              	#if INIT_SECTIONS
 128              	HardwareSetup:	
 129 0040 00000000 			.long	_HardwareSetup
 130              	data:
 131 0044 00000000 			.long	_data
 132              	mdata:
 133 0048 00000000 			.long	_mdata
 134              	edata:
 135 004c 00000000 			.long	_edata
 136              	bss:
 137 0050 00000000 			.long	_bss
 138              	ebss:
 139 0054 00000000 			.long	_ebss
 140              	#endif
 141              	
 142              	stack:
 143 0058 00000000 			.long	_stack
 144              	main:
 145 005c 00000000 			.long	_main
 146              	#ifdef CPPAPP	
 147              	_InitCtors:
 148              			.long	___main
 149              	#endif	
 150              	#if GDB_SIMULATOR_DEBUG
 151              	_exit_k:
 152              			.long   _exit
 153              	#endif
 154              	
 155              		.end
